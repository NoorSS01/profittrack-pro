RewriteEngine On

# PWA: Allow service worker to have broader scope
<FilesMatch "sw\.js$">
    Header set Service-Worker-Allowed "/"
    Header set Cache-Control "no-cache, no-store, must-revalidate"
</FilesMatch>

# PWA: Proper MIME types and cache control for manifest
<FilesMatch "manifest\.webmanifest$">
    Header set Content-Type "application/manifest+json"
    Header set Cache-Control "no-cache, no-store, must-revalidate"
</FilesMatch>

# Serve the built React app from /dist
RewriteCond %{REQUEST_URI} !^/dist/
RewriteRule ^$ /dist/index.html [L]

# For client-side routes, send everything to the SPA entry
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ /dist/index.html [L]
